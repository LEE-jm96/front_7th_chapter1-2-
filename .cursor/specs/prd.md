# 반복 일정 기능 명세 (`prd.md`)

이 문서는 **반복 일정(Recurring Event)** 기능을 TDD 기반으로 개발할 때  
테스트 설계 에이전트(TT.md)가 참고해야 할 상세 명세를 정의합니다.  
모든 테스트는 RED → GREEN → REFACTOR 사이클을 따릅니다.

---

## 1. TDD 기본 원칙

1. **RED (실패 테스트 작성)**  
   - 명세에 정의된 동작을 기준으로 테스트를 먼저 작성합니다.  
   - 아직 기능이 없거나 실패해야 정상입니다.  

2. **GREEN (기능 구현)**  
   - 테스트를 통과시키기 위한 최소한의 코드만 작성합니다.  
   - 하드코딩이 허용됩니다. (테스트를 통과시키는 것이 우선)

3. **REFACTOR (리팩토링)**  
   - 테스트가 통과된 이후에만 코드 개선을 진행합니다.  
   - 중복 제거, 의미 있는 네이밍, 구조 개선을 수행합니다.

---

## 2. 기능 명세

### 2.1 반복 유형 선택 (Repeat Type Selection)

  - 일정 생성 또는 수정 시 반복 유형을 선택할 수 있다.
  - 반복 유형은 다음과 같다: 매일, 매주, 매월, 매년
      - 31일에 매월을 선택한다면 → 매월 마지막이 아닌, 31일에만 생성하세요.
      - 윤년 29일에 매년을 선택한다면 → 29일에만 생성하세요!
  - 반복일정은 일정 겹침을 고려하지 않는다.

**예외 규칙**
- 31일에 “매월”을 선택한 경우 → “매월 마지막”이 아닌, **31일에만 생성**되어야 한다.  
- 윤년의 2월 29일에 “매년”을 선택한 경우 → **2월 29일에만 생성**되어야 한다.
- 반복 일정은 다른 일정과의 겹침을 고려하지 않는다.

**TDD 가이드**
- RED: “반복 유형을 선택할 수 있다” 테스트 작성  
- GREEN: 반복 유형 로직 구현  
- REFACTOR: 반복일 계산 로직을 `getNextRepeatDate()` 유틸로 분리

---

### 2.2 반복 일정 표시 (Repeat Display)

- 캘린더 뷰에서 반복 일정은 **반복 아이콘(🔁)** 으로 표시되어야 한다.  
- 단일 일정은 아이콘이 표시되지 않는다.

**TDD 가이드**
- RED: “반복 일정은 반복 아이콘을 표시한다” 테스트 작성  
- GREEN: 조건부 렌더링 구현  
- REFACTOR: 반복 여부를 확인하는 로직을 `isRepeating()` 헬퍼로 분리

---

### 2.3 반복 종료 조건 (Repeat End)

- 반복 종료 조건을 지정할 수 있다.
- 옵션: 특정 날짜(`until`)
  - 예: `2025-12-31`까지 반복  
- 종료일 이후에는 반복이 생성되지 않아야 한다.

**TDD 가이드**
- RED: “2025-12-31 이후 일정은 생성되지 않는다” 테스트 작성  
- GREEN: `endDate` 체크 로직 구현  
- REFACTOR: 반복 생성 로직을 `generateRepeatsUntil()` 함수로 분리

---

### 2.4 반복 일정 수정 (Repeat Edit)

- 반복 일정 수정 시 “해당 일정만 수정하시겠어요?” 라는 메시지가 표시되어야 한다.

#### 2.4.1 ‘예’를 누르는 경우 (단일 수정)
- 해당 일정만 수정된다.  
- 해당 일정은 **반복 일정이 아닌 단일 일정으로 변경**된다.  
- 반복 아이콘이 제거되어야 한다.

#### 2.4.2 ‘아니오’를 누르는 경우 (전체 수정)
- 동일한 반복 그룹의 모든 일정이 수정된다.  
- 반복 아이콘은 그대로 유지된다.

**TDD 가이드**
- RED: “예 선택 시 단일 수정이 된다” 테스트 작성  
- GREEN: 단일 수정 로직 구현  
- REFACTOR: 수정 모달 및 반복 관리 로직 분리

---

### 2.5 반복 일정 삭제 (Repeat Delete)

- 반복 일정 삭제 시 “해당 일정만 삭제하시겠어요?” 라는 메시지가 표시되어야 한다.

#### 2.5.1 ‘예’를 누르는 경우 (단일 삭제)
- 선택한 일정만 삭제된다.  

#### 2.5.2 ‘아니오’를 누르는 경우 (전체 삭제)
- 동일한 반복 그룹의 모든 인스턴스가 삭제된다.

**TDD 가이드**
- RED: “예 선택 시 단일 삭제 테스트 작성”  
- GREEN: 삭제 로직 구현  
- REFACTOR: `deleteSingleOrAll()` 함수로 로직 통합

---

## 3. AI 개발 시 주의사항

- 반드시 테스트부터 작성해야 합니다. (RED 우선)
- 명세에 없는 기능은 추가하지 않습니다.
- 테스트 설명(`describe`, `it`)은 한글로 작성합니다.
- 테스트 함수명은 명세 문장 그대로 작성해야 합니다.  
  예: `"31일에 매월을 선택하면 31일에만 생성된다"`
- 테스트 프레임워크는 `vitest` 또는 `@testing-library/react`를 사용합니다.
- 상태 관리는 React의 `useState`, `useEffect`를 사용합니다.
- 날짜 연산은 `dayjs` 사용을 기본으로 합니다.

---